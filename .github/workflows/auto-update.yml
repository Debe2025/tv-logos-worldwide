name: Daily TV Logos & M3U Update (Multi-Source)

# Trigger daily at 02:00 UTC or manual trigger
on:
  schedule:
    - cron: "0 2 * * *"
  workflow_dispatch:

jobs:
  update-logos:
    runs-on: ubuntu-latest

    steps:
      # Step 1: Checkout repository
      - name: Checkout repository
        uses: actions/checkout@v4

      # Step 2: Setup Python
      - name: Setup Python
        uses: actions/setup-python@v5
        with:
          python-version: "3.11"

      # Step 3: Install dependencies
      - name: Install dependencies
        run: |
          python -m pip install --upgrade pip
          pip install requests svglib reportlab beautifulsoup4

      # Step 4: Run the unified multi-source logo + M3U script
      - name: Generate logos & M3U
        run: python tv-logos-worldwide.py

      # Step 5: Commit only changed files
      - name: Commit & push changes
        run: |
          git config user.name "github-actions"
          git config user.email "github-actions@github.com"

          # Stage only changes inside tv-logos-worldwide
          git add tv-logos-worldwide/*

          # Commit only if there are actual changes
          if ! git diff --cached --quiet; then
            git commit -m "Daily auto-update: TV logos & M3U"
            git push
          else
            echo "No changes detected, skipping commit."
